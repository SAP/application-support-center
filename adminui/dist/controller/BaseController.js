sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","asc/admin/util/formatter","asc/admin/util/API","sap/ui/model/json/JSONModel"],function(e,t,n,i,o,s){o=new o;return e.extend("asc.admin.controller.BaseController",{formatter:i,toast:n.show.bind(n),msgBox:t,_busyDialog:null,api:o,busy:function(){sap.ui.core.BusyIndicator.show(0)},unbusy:function(){sap.ui.core.BusyIndicator.hide(0)},onErrorMessage:function(e){t.error(e)},onToast:function(e){n.show(e)},setLayout:function(e){var t=this.getOwnerComponent().getModel("layout");t.setProperty("/layout",e)},checkIfUserIsAllowedToEdit:function(){var e=this.getOwnerComponent().getModel("app_contacts");var t=this.getOwnerComponent().getModel("user");var n=false;if(e&&e.getData().length>0){var i=e.getData();i.forEach(function(e,i){if(e.external_id.toLowerCase()===t.getData().userId.toLowerCase()){n=true}})}if(this.getView().getModel("user").getData().role==="admin"||n){this.getView().byId("idButtonEditApp").setVisible(true);this.getView().byId("idButtonDeleteApp").setVisible(true);this.getView().byId("idLabelAuthToken").setVisible(true);this.getView().byId("idLinkAuthToken").setVisible(true)}else{this.getView().byId("idButtonEditApp").setVisible(false);this.getView().byId("idButtonDeleteApp").setVisible(false);this.getView().byId("idLabelAuthToken").setVisible(false);this.getView().byId("idLinkAuthToken").setVisible(false)}},onHTTPFail:function(e){n.show("Server error processing this request.")},addRecordToModelAndRefresh:function(e,t){var n=this.getView().getModel(e);n.getData().push(t);n.setProperty("/"+e,n)},onValidate:function(){var e=this.getView().getId();var t=false;jQuery("input[required=required]").each(function(){var n=sap.ui.getCore().byId(this.id.replace(/-inner/g,""));if(n.getId().startsWith(e)&&(n instanceof sap.m.Input||n instanceof sap.m.DatePicker)){var i=n.getValue();if(!i){n.setValueState(sap.ui.core.ValueState.Error);n.openValueStateMessage();t=true}else{n.setValueState(sap.ui.core.ValueState.None);n.closeValueStateMessage()}}});if(!t){this.onSavePress()}},validateControl:function(e){var t=sap.ui.getCore().byId(e.getSource().getId());var n=e.getParameter("value");if(!n){t.setValueState(sap.ui.core.ValueState.Error);t.openValueStateMessage()}else{t.setValueState(sap.ui.core.ValueState.None);t.closeValueStateMessage()}},jsonToCSV:function(e,t){const n=e;const i=(e,t)=>t===null?"":t;const o=Object.keys(n[0]);let s=n.map(e=>o.map(t=>JSON.stringify(e[t],i)).join(","));s.unshift(o.join(","));s=s.join("\r\n");var a=new Blob([s],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob){navigator.msSaveBlob(a,t)}else{var r=document.createElement("a");if(r.download!==undefined){var l=URL.createObjectURL(a);r.setAttribute("href",l);r.setAttribute("download",t);r.style.visibility="hidden";document.body.appendChild(r);r.click();document.body.removeChild(r)}}},onGetActiveUser:function(){this.api.getActiveUser().done(this.onGetActiveUserDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetApps:function(){this.api.getApps().done(this.onGetAppsDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetContacts:function(){this.api.getContacts().done(this.onGetContactsDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetAllSettings:function(){this.api.getAllSettings().done(this.onGetSettingsDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetAllNotifications:function(){this.api.getAllNotifications().done(this.onGetNotificationsDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetAppUsageData:function(e,t){this.api.getAppUsageData(e,t).done(this.onGetAppUsageDataDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetAppHelp:function(e){this.api.getAppHelp(e).done(this.onGetHelpDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetAppContacts:function(e,t){var n=this;this.api.getAppContacts(e).done(function(e){var i=new s(e);n.getOwnerComponent().setModel(i,"app_contacts");if(t){n.checkIfUserIsAllowedToEdit()}}).fail(this.onHTTPFail.bind(this))},onGetAppKeywords:function(e){this.api.getAppKeywords(e).done(this.onGetAppKeywordsDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetAppAnnouncements:function(e){this.api.getAppAnnouncements(e).done(this.onGetAppAnnouncementsDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetAppReleases:function(e){this.api.getAppReleases(e).done(this.onGetAppReleasesDone.bind(this)).fail(this.onHTTPFail.bind(this))},onGetAppsDone:function(e){var t=new s(e);t.setSizeLimit(1e3);this.getOwnerComponent().setModel(t,"apps")},onGetContactsDone:function(e){var t=new s(e);t.setSizeLimit(1e3);this.getOwnerComponent().setModel(t,"contacts")},onGetSettingsDone:function(e){var t={};e.forEach(function(e,n){if(!t[e.setting_name]){t[e.setting_name]=[]}t[e.setting_name].push({key:e.setting_key,value:e.setting_value})});var n=new s(t);this.getOwnerComponent().setModel(n,"options")},onGetNotificationsDone:function(e){var t=new s(e);t.setSizeLimit(1e3);this.getOwnerComponent().setModel(t,"notifications")},onGetHelpDone:function(e){var t=new s(e);this.getOwnerComponent().setModel(t,"app_help")},onGetAppUsageDataDone:function(e){var t=new s(e);this.getOwnerComponent().setModel(t,"app_usage")},onGetAppKeywordsDone:function(e){var t=new s(e);this.getOwnerComponent().setModel(t,"app_keywords")},onGetAppAnnouncementsDone:function(e){var t=new s(e);this.getOwnerComponent().setModel(t,"app_announcements")},onGetAppReleasesDone:function(e){var t=new s(e);this.getOwnerComponent().setModel(t,"app_releases")}})});