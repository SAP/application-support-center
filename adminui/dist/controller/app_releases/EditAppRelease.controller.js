sap.ui.define(["../BaseController"],function(e){var t;return e.extend("asc.admin.controller.app_releases.EditAppRelease",{onInit:function(){var e=this;this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("editapprelease").attachPatternMatched(this._onReleaseMatched,this);sap.ui.require(["sap/ui/richtexteditor/RichTextEditor","sap/ui/richtexteditor/EditorType"],function(i,a){t=new i("idEditAppReleaseRichDescription",{editorType:a.TinyMCE4,width:"90%",height:"300px",customToolbar:true,showGroupFont:false,showGroupLink:true,showGroupInsert:false,value:"",ready:function(){this.setValue(e._app_release_detail.description);this.addButtonGroup("styleselect").addButtonGroup("table");this.addStyleClass("formattedTextPadding")}});e.getView().byId("idVerticalLayout").addContent(t)})},_onReleaseMatched:function(e){this._app_release=e.getParameter("arguments").app_release||this._app_release||"0";this._app=e.getParameter("arguments").app||this._app||"0";this._appDetail=this.getView().getModel("apps").getProperty("/"+this._app);this.getView().setBusyIndicatorDelay(0);this.getView().bindElement({path:"/"+this._app_release,model:"app_releases"});if(this._app_release){this._app_release_detail=this.getView().getModel("app_releases").oData[this._app_release]}if(t){t.setValue(this._app_release_detail.description)}},onCancelPress:function(){this.oRouter.navTo("editapp",{app:this._app})},onSavePress:function(e){this._app_release_detail.description=t.getValue();this.api.putAppRelease(this._app_release_detail.app_id,this._app_release_detail.release_id,this._app_release_detail).done(this.onEditReleaseDone.bind(this)).fail(this.onHTTPFail.bind(this))},changeDate:function(e){this._app_release_detail.release_date=e.getParameter("value")},onEditReleaseDone:function(e){this.onToast("Success!");this.onGetAppReleases(this._appDetail.app_id);this.oRouter.navTo("editapp",{app:this._app})},onAddJamf:function(){if(this._appDetail.bundle_id!==""&&this._appDetail.bundle_id!==null&&this._appDetail.bundle_id!=="null"){this.getView().byId("addJamfDialog").open();this.getView().byId("addJamfDialog").setBusyIndicatorDelay(10);this.onSelectJamfSystem()}else{this.onErrorMessage("A bundle ID is required")}},onSelectJamfSystem:function(e){this.getView().byId("addJamfDialog").setBusy(true);this.sJamfSystem=this.getView().byId("idSelectReleaseJamfSystem").getSelectedKey();this.api.postJamfAppinfo(this._appDetail.bundle_id,this.sJamfSystem).done(this.onGetJamfAppInfo.bind(this)).fail(this.onGetJamfAppInfoFail.bind(this))},onAddJamfFileBeforeUpload:function(e){this.getView().byId("addJamfDialog").setBusy(true)},onAddJamfFilePress:function(e){var t=this.byId("idFileUploaderAppIPA");var i=t.oFileUpload.files[0].name;if(i){this.getView().byId("idFileUploaderAppIPA").setButtonText(i);this.getView().byId("idJamfFileUploadConfirmLabel").setVisible(true);this.getView().byId("idJamfFileUploadConfirmButton").setVisible(true)}},onAddJamfFileUploadPress:function(e){var t=this;this.getView().byId("addJamfDialog").setBusy(true);setTimeout(function(){var e=t.byId("idFileUploaderAppIPA");var i=new FormData;i.append("file",e.oFileUpload.files[0]);var a=t.getView().byId("idTextReleaseJamfAppID").getText();var s=t.getView().byId("idInputAppVersion").getValue();var o=t._appDetail.app_id;t.api.postJamfAppIPA(a,i,o,s,t.sJamfSystem).done(t.onPostJamfAppIPA.bind(t)).fail(t.onGetJamfAppInfoFail.bind(t))},500)},onDialogCloseButton:function(e){this.clearForm();this.getView().byId("addJamfDialog").close()},clearForm:function(){this.getView().byId("addJamfDialog").setBusy(false);this.getView().byId("idTextReleaseJamfVersion").setText("");this.getView().byId("idTextReleaseJamfFilename").setText("");this.getView().byId("idTextReleaseBundleID").setText("");this.getView().byId("idTextReleaseJamfAppID").setText("")},onGetJamfAppInfo:function(e){this.getView().byId("addJamfDialog").setBusy(false);if(e){this.getView().byId("idTextReleaseJamfVersion").setText(e.mobile_device_application.general.version);this.getView().byId("idTextReleaseJamfFilename").setText(e.mobile_device_application.general.ipa.name);this.getView().byId("idTextReleaseBundleID").setText(e.mobile_device_application.general.bundle_id);this.getView().byId("idTextReleaseJamfAppID").setText(e.mobile_device_application.general.id)}},onGetJamfAppInfoFail:function(){this.clearForm();this.onToast("IPA File not uploaded, please try again")},onPostJamfAppIPA:function(e){this.getView().byId("addJamfDialog").setBusy(false);this.onToast("IPA File Uploaded");var t=this;setTimeout(function(){t.onSelectJamfSystem()},5e3);this.getView().byId("addJamfDialog").close()}})},true);