sap.ui.define(["../BaseController"],function(e){return e.extend("asc.admin.controller.app.EditApp",{onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("editapp").attachPatternMatched(this._onAppMatched,this)},_onAppMatched:function(e){this._app=e.getParameter("arguments").app||this._app||"0";this.getView().bindElement({path:"/"+this._app,model:"apps"});this._appDetail=this.getView().getModel("apps").getProperty("/"+this._app);if(this._appDetail.go_live&&this._appDetail.go_live!==""){this.byId("idDatePickerGoLive").setDateValue(new Date(this._appDetail.go_live))}if(this._appDetail.retired&&this._appDetail.retired!==""){this.byId("idDatePickerRetired").setDateValue(new Date(this._appDetail.retired))}if(this._appDetail&&this.getOwnerComponent().getModel("selected_app")==undefined){this.onGetAppHelp(this._appDetail.app_id);this.onGetAppReleases(this._appDetail.app_id);this.onGetAppKeywords(this._appDetail.app_id);this.onGetAppAnnouncements(this._appDetail.app_id);this.onGetAppContacts(this._appDetail.app_id,false);var t=new sap.ui.model.json.JSONModel;t.setData(this._appDetail);this.getOwnerComponent().setModel(t,"selected_app")}this.setAppIcon()},onCancelPress:function(){this.oRouter.navTo("viewapp",{app:this._app})},onAddHelpPress:function(e){this.oRouter.navTo("addapphelp",{app:this._app})},onAddContactPress:function(e){this.oRouter.navTo("addappcontact",{app:this._app})},onAddKeywordPress:function(e){this.oRouter.navTo("addappkeyword",{app:this._app})},onAddReleasePress:function(e){this.oRouter.navTo("addapprelease",{app:this._app})},onAddAnnouncementPress:function(e){this.oRouter.navTo("addappannouncement",{app:this._app})},onEditHelpPress:function(e){var t=e.getSource().getBindingContext("app_help").getPath();var i=t.split("/").slice(-1).pop();this.oRouter.navTo("editapphelp",{app:this._app,app_help:i})},onEditContactPress:function(e){var t=e.getSource().getBindingContext("app_contacts").getPath();var i=t.split("/").slice(-1).pop();this.oRouter.navTo("editappcontact",{app:this._app,app_contact:i})},onEditKeywordPress:function(e){var t=e.getSource().getBindingContext("app_keywords").getPath();var i=t.split("/").slice(-1).pop();this.oRouter.navTo("editappkeyword",{app:this._app,app_keyword:i})},onEditReleasePress:function(e){var t=e.getSource().getBindingContext("app_releases").getPath();var i=t.split("/").slice(-1).pop();this.oRouter.navTo("editapprelease",{app:this._app,app_release:i})},onEditAnnouncementPress:function(e){var t=e.getSource().getBindingContext("app_announcements").getPath();var i=t.split("/").slice(-1).pop();this.oRouter.navTo("editappannouncement",{app:this._app,app_announcement:i})},onAvatarAppIconPress:function(e){$("#__xmlview2--idFileUploaderAppIcon-fu").trigger("click")},setAppIcon:function(){try{this.getView().byId("idAvatarAppIconBig").setSrc("/serverresources/app_icons/"+this._appDetail.app_id+".png?"+(new Date).getTime());this.getView().byId("idAvatarAppIconSmall").setSrc("/serverresources/app_icons/"+this._appDetail.app_id+".png?"+(new Date).getTime())}catch(e){console.log("Unable to set icon")}},onAppIconSelect:function(e){var t=this.byId("idFileUploaderAppIcon");var i=new FormData;i.append("file",t.oFileUpload.files[0]);this.api.postAppIcon(this._appDetail.app_id,i).done(this.onPostAppIcon.bind(this)).fail(this.onHTTPFail.bind(this))},onAvatarJamfSyncPress:function(e){var t=this;this.api.putAppIconSync(this._appDetail.app_id,this._appDetail.bundle_id).done(function(){t.setAppIcon()}).fail(this.onHTTPFail.bind(this))},onPostAppIcon:function(e){this.setAppIcon()},onSavePress:function(e){this.api.putApp(this._appDetail.app_id,this._appDetail).done(this.onEditAppDone.bind(this)).fail(this.onHTTPFail.bind(this))},onRemoveHelpPress:function(e){var t=this.getView().byId("idTableHelp");var i=t.getSelectedContexts();var a=this.getView().oPropagatedProperties.oModels.app_help.getData();for(var p=i.length-1;p>=0;p--){var o=i[p].getObject();var n=i[p].getPath().replace("/","");a.splice(n,1);this.getView().oPropagatedProperties.oModels.app_help.setData(a);this.api.deleteAppHelp(o.app_id,o.help_id).done(this.onRemoveHelpDone.bind(this)).fail(this.onHTTPFail.bind(this))}t.removeSelections()},onRemoveContactPress:function(e){var t=this.getView().byId("idTableContacts");var i=t.getSelectedContexts();var a=this.getView().oPropagatedProperties.oModels.app_contacts.getData();for(var p=i.length-1;p>=0;p--){var o=i[p].getObject();var n=i[p].getPath().replace("/","");a.splice(n,1);this.getView().oPropagatedProperties.oModels.app_contacts.setData(a);this.api.deleteAppContact(o.app_id,o.contact_id).done(this.onRemoveContactDone.bind(this)).fail(this.onHTTPFail.bind(this))}t.removeSelections()},onRemoveKeywordPress:function(e){var t=this.getView().byId("idTableKeywords");var i=t.getSelectedContexts();var a=this.getView().oPropagatedProperties.oModels.app_keywords.getData();for(var p=i.length-1;p>=0;p--){var o=i[p].getObject();var n=i[p].getPath().replace("/","");a.splice(n,1);this.getView().oPropagatedProperties.oModels.app_keywords.setData(a);this.api.deleteAppKeyword(o.app_id,o.keyword_id).done(this.onRemoveKeywordDone.bind(this)).fail(this.onHTTPFail.bind(this))}t.removeSelections()},onRemoveReleasePress:function(e){var t=this.getView().byId("idTableReleases");var i=t.getSelectedContexts();var a=this.getView().oPropagatedProperties.oModels.app_releases.getData();for(var p=i.length-1;p>=0;p--){var o=i[p].getObject();var n=i[p].getPath().replace("/","");a.splice(n,1);this.getView().oPropagatedProperties.oModels.app_releases.setData(a);this.api.deleteAppRelease(o.app_id,o.release_id).done(this.onRemoveReleaseDone.bind(this)).fail(this.onHTTPFail.bind(this))}t.removeSelections()},onRemoveAnnouncementPress:function(e){var t=this.getView().byId("idTableAnnouncements");var i=t.getSelectedContexts();var a=this.getView().oPropagatedProperties.oModels.app_announcements.getData();for(var p=i.length-1;p>=0;p--){var o=i[p].getObject();var n=i[p].getPath().replace("/","");a.splice(n,1);this.getView().oPropagatedProperties.oModels.app_announcements.setData(a);this.api.deleteAppAnnouncement(o.app_id,o.announcement_id).done(this.onRemoveAnnouncementDone.bind(this)).fail(this.onHTTPFail.bind(this))}t.removeSelections()},onEditAppDone:function(e){this.onToast("Success!");this.oRouter.navTo("viewapp",{app:this._app})},onRemoveHelpDone:function(e){this.onToast("Success!")},onRemoveContactDone:function(e){this.onToast("Success!")},onRemoveKeywordDone:function(e){this.onToast("Success!")},onRemoveAnnouncementDone:function(e){this.onToast("Success!")},onRemoveReleaseDone:function(e){this.onToast("Success!")}})},true);